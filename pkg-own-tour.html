<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Ayubowan Tours – Animated Premium Pins</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <!-- Leaflet Routing Machine -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css" />
    <script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>
    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background: #f7f9fc;
        }

        header,
        footer {
            background: #2c3e50;
            color: #fff;
        }

        .flex-container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 30px 0;
        }

        .box {
            background: #fff;
            border: 2px dashed #bbb;
            border-radius: 10px;
            padding: 15px;
            max-width: 420px;
            flex: 1 1 320px;
        }

        .items-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .item {
            background: linear-gradient(135deg, #fff, #eef3ff);
            padding: 6px;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
        }

        .item img {
            width: 100%;
            height: 90px;
            object-fit: cover;
            border-radius: 5px;
        }

        .traveler-info {
            background: #fff;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #3498db;
        }

        .invalid {
            border-color: red !important;
        }

        .valid {
            border-color: green !important;
        }

        .validation-message {
            font-size: 0.8rem;
            color: red;
            display: none;
        }

        #map {
            width: 100%;
            height: 350px;
            margin-top: 10px;
            border-radius: 8px;
        }

        .popup-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 999;
        }

        .popup-box {
            background: #fff;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            max-width: 400px;
        }

        /* Custom scalable animated pin */
        .pin-icon {
            position: relative;
            width: 36px;
            height: 46px;
            border-radius: 50% 50% 50% 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
            border: 2px solid #fff;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
            animation: pulse 2s infinite ease-in-out;
        }

        .pin-icon::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 12px;
            height: 12px;
            background: inherit;
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
            }

            50% {
                transform: scale(1.1);
                box-shadow: 0 4px 14px rgba(0, 0, 0, 0.5);
            }

            100% {
                transform: scale(1);
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
            }
        }
    </style>
</head>

<body>

    <header class="py-3 text-center">
        <h2><i class="fa fa-map-marker-alt"></i> Ayubowan Tours</h2>
    </header>

    <nav aria-label="breadcrumb">
        <ol class="breadcrumb container">
            <li class="breadcrumb-item"><a href="./index.html">Home</a></li>
            <li class="breadcrumb-item"><a href="./packages.html">Packages</a></li>
            <li class="breadcrumb-item active" aria-current="page">Design Your Journey</li>
        </ol>
    </nav>

    <div class="container text-center">
        <p>Select destinations to build your itinerary and see your route on the map!</p>
    </div>

    <div class="flex-container">
        <!-- Available Places -->
        <div class="box">
            <h3 class="text-center">Explore Destinations</h3>
            <div class="items-grid" id="availableGrid">
                <div class="item" data-id="Kandy"><img src="img/kandy-package-card.jpeg">
                    <div>Kandy</div>
                </div>
                <div class="item" data-id="Sigiriya"><img src="img/kandy-dambulla-sirigiya-package-card.jpg">
                    <div>Sigiriya</div>
                </div>
                <div class="item" data-id="Ella"><img src="img/14-day-tour-srilanka-ella.jpg">
                    <div>Ella</div>
                </div>
                <div class="item" data-id="Yala"><img src="img/14-day-tour-srilanka-yala.jpg">
                    <div>Yala Safari</div>
                </div>
                <div class="item" data-id="Galle"><img src="img/14-day-tour-srilanka-galle.jpg">
                    <div>Galle</div>
                </div>
            </div>
        </div>

        <!-- Selected Places -->
        <div class="box">
            <h3 class="text-center">Your Selected Journey</h3>
            <div class="items-grid" id="selectedGrid"></div>
        </div>

        <!-- Booking Details -->
        <div class="traveler-info">
            <h3>Complete Your Travel Details</h3>
            <input class="form-control mb-1" id="name" placeholder="Full Name">
            <div class="validation-message" id="nameMsg">Name is required</div>

            <input class="form-control mb-1" id="phone" placeholder="Phone Number">
            <div class="validation-message" id="phoneMsg">Enter valid phone</div>

            <input class="form-control mb-1" id="email" placeholder="Email Address">
            <div class="validation-message" id="emailMsg">Enter valid email</div>

            <input class="form-control mb-1" type="number" id="adults" min="1" placeholder="Number of Adults">
            <div class="validation-message" id="adultsMsg">At least 1 adult required</div>

            <input class="form-control mb-1" type="number" id="children" min="0" placeholder="Number of Children">

            <label class="mt-2">Arrival Date</label>
            <input class="form-control mb-1" type="date" id="arrival">
            <div class="validation-message" id="arrivalMsg">Arrival date required</div>

            <label>Departure Date</label>
            <input class="form-control mb-1" type="date" id="departure">
            <div class="validation-message" id="departureMsg">Departure date must be after arrival</div>

            <!-- Map -->
            <div id="map"></div>

            <button class="btn btn-success w-100 mt-3" id="sendWhatsApp" disabled><i class="fa-brands fa-whatsapp"></i>
                Send via WhatsApp</button>
            <button class="btn btn-primary w-100 mt-2" id="sendEmail" disabled><i class="fa fa-envelope"></i> Send via
                Email</button>
            <button class="btn btn-info w-100 mt-2" id="generatePDF"><i class="fa fa-file-pdf"></i> Download Travel
                Summary PDF</button>
        </div>
    </div>

    <footer class="py-3 text-center">
        <p>© Ayubowan Tours – All Rights Reserved</p>
    </footer>

    <div class="popup-overlay" id="popupOverlay">
        <div class="popup-box">
            <p>Thank you! Your booking request has been received.</p>
            <button class="btn btn-success" id="popupOk">OK</button>
        </div>
    </div>

    <script>
        const coords = {
            Kandy: [7.2906, 80.6337],
            Sigiriya: [7.9570, 80.7603],
            Ella: [6.8667, 81.0466],
            Yala: [6.3667, 81.5167],
            Galle: [6.0535, 80.2210]
        };

        const colors = ['#1abc9c', '#3498db', '#9b59b6', '#e67e22', '#e74c3c', '#f1c40f', '#2ecc71', '#34495e'];

        let map = L.map('map').setView(coords.Kandy, 7);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '&copy; <a href="https://openstreetmap.org">OSM</a> contributors' }).addTo(map);

        let routeControl = null;
        let markers = [];

        const availableGrid = document.getElementById('availableGrid'),
            selectedGrid = document.getElementById('selectedGrid');

        function bindItem(item) {
            item.onclick = () => {
                const target = item.parentElement.id === 'availableGrid' ? selectedGrid : availableGrid;
                target.appendChild(item);
                updateRouteMap();
                validate();
            };
        }
        document.querySelectorAll('.item').forEach(bindItem);

        function createPinIcon(number) {
            const color = colors[(number - 1) % colors.length];
            return L.divIcon({
                html: `<div class="pin-icon" style="background:${color}">${number}</div>`,
                className: '',
                iconSize: [36, 46],
                iconAnchor: [18, 46]
            });
        }

        function updateRouteMap() {
            markers.forEach(m => map.removeLayer(m));
            markers = [];
            if (routeControl) { map.removeControl(routeControl); routeControl = null; }

            if (selectedGrid.children.length < 1) {
                map.setView(coords.Kandy, 7);
                return;
            }

            const waypoints = [...selectedGrid.children].map(i => L.latLng(coords[i.dataset.id]));

            waypoints.forEach((wp, i) => {
                const marker = L.marker(wp, { icon: createPinIcon(i + 1) }).addTo(map);
                markers.push(marker);
            });

            if (waypoints.length > 1) {
                routeControl = L.Routing.control({
                    waypoints: waypoints,
                    lineOptions: { styles: [{ color: 'blue', weight: 4 }] },
                    createMarker: () => null,
                    routeWhileDragging: false,
                    addWaypoints: false,
                    draggableWaypoints: false,
                    show: false
                }).addTo(map);
            }

            const group = new L.featureGroup(markers);
            map.fitBounds(group.getBounds().pad(0.2));
        }

        // Validation & Booking
        function toggle(id, cond, msg) { const el = document.getElementById(id); el.classList.toggle('invalid', !cond); el.classList.toggle('valid', cond); document.getElementById(msg).style.display = cond ? 'none' : 'block'; return cond; }
        function validate() {
            let ok = true;
            ok &= toggle('name', name.value.trim() !== '', 'nameMsg');
            ok &= toggle('phone', /^[0-9]{7,15}$/.test(phone.value), 'phoneMsg');
            ok &= toggle('email', /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email.value), 'emailMsg');
            ok &= toggle('adults', adults.value >= 1, 'adultsMsg');
            ok &= toggle('arrival', arrival.value, 'arrivalMsg');
            ok &= toggle('departure', departure.value > arrival.value, 'departureMsg');

            sendWhatsApp.disabled = !ok || !selectedGrid.children.length;
            sendEmail.disabled = !ok || !selectedGrid.children.length;
            generatePDF.disabled = !ok || !selectedGrid.children.length;
            return ok;
        }
        ['name', 'phone', 'email', 'adults', 'children', 'arrival', 'departure'].forEach(id => document.getElementById(id).addEventListener('input', validate));

        sendWhatsApp.onclick = () => {
            if (!validate()) return;
            const msg = `Ayubowan Tours Booking
Name: ${name.value}
Phone: ${phone.value}
Email: ${email.value}
Adults: ${adults.value}
Children: ${children.value}
Arrival: ${arrival.value}
Departure: ${departure.value}

Itinerary:
${[...selectedGrid.children].map((i, x) => `${x + 1}. ${i.dataset.id}`).join('\n')}`;
            window.open(`https://wa.me/94763661600?text=${encodeURIComponent(msg)}`, '_blank');
            setTimeout(() => popupOverlay.style.display = 'flex', 800);
        };

        sendEmail.onclick = () => {
            if (!validate()) return;
            const body = [...selectedGrid.children].map((i, x) => `${x + 1}. ${i.dataset.id}`).join('\n');
            location.href = `mailto:info@ayubowantours.com?subject=Booking Request&body=${encodeURIComponent(body)}`;
        };

        generatePDF.onclick = () => {
            if (!validate()) return;
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.setFontSize(16);
            doc.text("Ayubowan Tours - Travel Summary", 10, 20);
            doc.setFontSize(12);
            doc.text(`Name: ${name.value}`, 10, 30);
            doc.text(`Phone: ${phone.value}`, 10, 37);
            doc.text(`Email: ${email.value}`, 10, 44);
            doc.text(`Adults: ${adults.value}  Children: ${children.value}`, 10, 51);
            doc.text(`Arrival: ${arrival.value}  Departure: ${departure.value}`, 10, 58);
            doc.text("Itinerary:", 10, 68);
            [...selectedGrid.children].forEach((i, x) => doc.text(`${x + 1}. ${i.dataset.id}`, 12, 76 + x * 7));
            doc.save("Travel_Summary.pdf");
        };

        popupOk.onclick = () => location.reload();
    </script>

</body>

</html>