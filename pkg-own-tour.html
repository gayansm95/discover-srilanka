<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ayubowan Tours â€“ Create Your Tour</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f4f6f8;
            padding: 20px;
        }

        h2,
        h3 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 15px
        }

        .flex-container {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .box-dragging {
            flex: 1 1 320px;
            max-width: 420px;
            background: #fff;
            border: 2px dashed #bbb;
            border-radius: 10px;
            padding: 15px;
            position: relative;
        }

        .items-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .item {
            border-radius: 8px;
            padding: 6px;
            background: linear-gradient(135deg, #ffffff, #eef3ff);
            text-align: center;
            cursor: pointer;
            transition: .25s;
            user-select: none;
        }

        .item img {
            width: 100%;
            height: 90px;
            object-fit: cover;
            border-radius: 5px;
        }

        .item.drag-hold {
            transform: scale(1.05);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, .6), 0 10px 25px rgba(0, 0, 0, .3);
        }

        #dropPulse {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: bold;
            color: #3498db;
            animation: pulse 1.5s infinite;
            pointer-events: none;
        }

        @keyframes pulse {
            0% {
                opacity: .4
            }

            50% {
                opacity: 1
            }

            100% {
                opacity: .4
            }
        }

        .traveler-info {
            flex: 1 1 320px;
            max-width: 420px;
            background: #fff;
            border-radius: 10px;
            padding: 20px;
        }

        #miniPreview {
            margin-top: 15px;
            display: flex;
            flex-direction: column;
            gap: 12px
        }

        .preview-card {
            padding: 10px;
            color: #fff;
            border-radius: 10px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, .25);
            transition: .3s;
        }

        .preview-card:hover {
            transform: translateY(-4px)
        }

        .preview-title {
            font-weight: 600;
            margin-bottom: 6px
        }

        .map-frame {
            width: 100%;
            height: 120px;
            border: 0;
            border-radius: 8px;
        }

        .invalid {
            border-color: red !important;
        }

        .valid {
            border-color: green !important;
        }

        .validation-message {
            font-size: 0.8rem;
            color: red;
            display: none;
        }

        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .popup-box {
            background: #fff;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            max-width: 400px;
        }

        .popup-box button {
            margin-top: 15px;
        }

        @media(max-width:768px) {
            .items-grid {
                grid-template-columns: 1fr
            }
        }
    </style>
</head>

<body>

    <h2>Create Your Own Tour</h2>

    <div class="flex-container">

        <!-- AVAILABLE -->
        <div class="box-dragging">
            <h3>Available Places</h3>
            <div class="items-grid" id="availableGrid">
                <div class="item" data-id="Kandy"><img src="img/kandy-package-card.jpeg">
                    <div>Kandy</div>
                </div>
                <div class="item" data-id="Sigiriya"><img src="img/kandy-dambulla-sirigiya-package-card.jpg">
                    <div>Sigiriya</div>
                </div>
                <div class="item" data-id="Ella"><img src="img/14-day-tour-srilanka-ella.jpg">
                    <div>Ella</div>
                </div>
                <div class="item" data-id="Yala"><img src="img/14-day-tour-srilanka-yala.jpg">
                    <div>Yala Safari</div>
                </div>
            </div>
        </div>

        <!-- SELECTED -->
        <div class="box-dragging">
            <h3>Selected Places</h3>
            <div class="items-grid" id="selectedGrid"></div>
            <div id="dropPulse">Click to Create The Tour</div>
        </div>

        <!-- BOOKING -->
        <div class="traveler-info">
            <h3>Booking Details</h3>

            <input class="form-control mb-1" id="name" placeholder="Customer Name">
            <div class="validation-message" id="nameMsg">Name is required.</div>

            <input class="form-control mb-1" id="phone" placeholder="Phone Number">
            <div class="validation-message" id="phoneMsg">Enter valid phone number.</div>

            <input class="form-control mb-1" id="email" placeholder="Email Address">
            <div class="validation-message" id="emailMsg">Enter valid email.</div>

            <input class="form-control mb-1" id="guests" type="number" min="1" value="1" placeholder="Number of Guests">
            <div class="validation-message" id="guestsMsg">Must have at least 1 guest.</div>

            <label class="mt-2">Arrival Date</label>
            <input class="form-control mb-1" id="arrival" type="date">
            <div class="validation-message" id="arrivalMsg">Arrival date is required.</div>

            <label>Departure Date</label>
            <input class="form-control mb-1" id="departure" type="date">
            <div class="validation-message" id="departureMsg">Departure date must be after arrival date.</div>

            <div id="miniPreview"><em>No places selected</em></div>

            <button class="btn btn-success w-100 mt-3" id="sendWhatsApp" disabled>Send via WhatsApp</button>
            <button class="btn btn-primary w-100 mt-2" id="sendEmail" disabled>Send via Email</button>
        </div>

    </div>

    <!-- Popup -->
    <div class="popup-overlay" id="popupOverlay">
        <div class="popup-box">
            <p>Thank you connecting with Ayubowan Tours! We received your booking request & our team will get back to
                you soon.</p>
            <button class="btn btn-success" id="popupOk">OK</button>
        </div>
    </div>

    <script>
        const availableGrid = document.getElementById('availableGrid');
        const selectedGrid = document.getElementById('selectedGrid');
        const dropPulse = document.getElementById('dropPulse');

        const placeMap = { Kandy: '7.2906,80.6337', Sigiriya: '7.9570,80.7603', Ella: '6.8667,81.0466', Yala: '6.3667,81.5167' };
        const gradients = ['linear-gradient(90deg,#6a11cb,#2575fc)', 'linear-gradient(90deg,#ff512f,#f09819)', 'linear-gradient(90deg,#43e97b,#38f9d7)', 'linear-gradient(90deg,#2193b0,#6dd5ed)'];

        // Load selected items from localStorage
        window.onload = function () {
            const stored = JSON.parse(localStorage.getItem('selectedPlaces') || '[]');
            stored.forEach(id => {
                const item = document.querySelector(`#availableGrid .item[data-id="${id}"]`);
                if (item) selectedGrid.appendChild(item);
            });
            updateUI();
        };

        let holdTimer;
        function bindItem(item) {
            item.onclick = () => moveItem(item);
            item.addEventListener('touchstart', () => holdTimer = setTimeout(() => item.classList.add('drag-hold'), 400));
            item.addEventListener('touchend', () => { clearTimeout(holdTimer); if (item.classList.contains('drag-hold')) { item.classList.remove('drag-hold'); moveItem(item); } });
        }
        document.querySelectorAll('.item').forEach(bindItem);

        function moveItem(item) {
            const target = item.parentElement.id === 'availableGrid' ? selectedGrid : availableGrid;
            target.appendChild(item);
            updateUI();
            saveToLocal();
        }

        [selectedGrid, availableGrid].forEach(grid => {
            grid.addEventListener('dragover', e => e.preventDefault());
            grid.addEventListener('drop', () => {
                if (window.dragged && !grid.contains(window.dragged)) { grid.appendChild(window.dragged); updateUI(); saveToLocal(); }
            });
        });

        function updateUI() {
            dropPulse.style.display = selectedGrid.children.length ? 'none' : 'block';
            const preview = document.getElementById('miniPreview');
            if (!selectedGrid.children.length) { preview.innerHTML = '<em>No places selected</em>'; validateForm(); return; }
            preview.innerHTML = '';
            [...selectedGrid.children].forEach((i, idx) => {
                const place = i.dataset.id;
                const card = document.createElement('div');
                card.className = 'preview-card';
                card.style.background = gradients[idx % gradients.length];
                card.innerHTML = `<div class="preview-title">${idx + 1}. ${place}</div>
                    <iframe class="map-frame" src="https://maps.google.com/maps?q=${placeMap[place]}&z=9&output=embed"></iframe>`;
                preview.appendChild(card);
            });
            validateForm();
        }

        function saveToLocal() {
            const selected = [...selectedGrid.children].map(i => i.dataset.id);
            localStorage.setItem('selectedPlaces', JSON.stringify(selected));
        }

        function formatItinerary() { return [...selectedGrid.children].map((i, x) => `${x + 1}. ${i.dataset.id}`).join('\n'); }

        // ---- Form Validation ----
        const fields = ['name', 'phone', 'email', 'guests', 'arrival', 'departure'];
        function validateForm() {
            let valid = true;
            const n = document.getElementById('name').value.trim();
            const p = document.getElementById('phone').value.trim();
            const e = document.getElementById('email').value.trim();
            const g = document.getElementById('guests').value;
            const a = document.getElementById('arrival').value;
            const d = document.getElementById('departure').value;

            // Name
            const nameEl = document.getElementById('name');
            if (!n) { nameEl.classList.add('invalid'); nameEl.classList.remove('valid'); document.getElementById('nameMsg').style.display = 'block'; valid = false; }
            else { nameEl.classList.remove('invalid'); nameEl.classList.add('valid'); document.getElementById('nameMsg').style.display = 'none'; }

            // Phone
            const phoneEl = document.getElementById('phone');
            const phoneRegex = /^[0-9]{7,15}$/;
            if (!p || !phoneRegex.test(p)) { phoneEl.classList.add('invalid'); phoneEl.classList.remove('valid'); document.getElementById('phoneMsg').style.display = 'block'; valid = false; }
            else { phoneEl.classList.remove('invalid'); phoneEl.classList.add('valid'); document.getElementById('phoneMsg').style.display = 'none'; }

            // Email
            const emailEl = document.getElementById('email');
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!e || !emailRegex.test(e)) { emailEl.classList.add('invalid'); emailEl.classList.remove('valid'); document.getElementById('emailMsg').style.display = 'block'; valid = false; }
            else { emailEl.classList.remove('invalid'); emailEl.classList.add('valid'); document.getElementById('emailMsg').style.display = 'none'; }

            // Guests
            const guestsEl = document.getElementById('guests');
            if (!g || g < 1) { guestsEl.classList.add('invalid'); guestsEl.classList.remove('valid'); document.getElementById('guestsMsg').style.display = 'block'; valid = false; }
            else { guestsEl.classList.remove('invalid'); guestsEl.classList.add('valid'); document.getElementById('guestsMsg').style.display = 'none'; }

            // Arrival
            const arrivalEl = document.getElementById('arrival');
            if (!a) { arrivalEl.classList.add('invalid'); arrivalEl.classList.remove('valid'); document.getElementById('arrivalMsg').style.display = 'block'; valid = false; }
            else { arrivalEl.classList.remove('invalid'); arrivalEl.classList.add('valid'); document.getElementById('arrivalMsg').style.display = 'none'; }

            // Departure
            const departureEl = document.getElementById('departure');
            if (!d || (a && d <= a)) { departureEl.classList.add('invalid'); departureEl.classList.remove('valid'); document.getElementById('departureMsg').style.display = 'block'; valid = false; }
            else { departureEl.classList.remove('invalid'); departureEl.classList.add('valid'); document.getElementById('departureMsg').style.display = 'none'; }

            // Enable buttons only if valid
            document.getElementById('sendWhatsApp').disabled = !valid || selectedGrid.children.length === 0;
            document.getElementById('sendEmail').disabled = !valid || selectedGrid.children.length === 0;
        }

        fields.forEach(f => document.getElementById(f).addEventListener('input', validateForm));

        // ---- WhatsApp Send ----
        document.getElementById('sendWhatsApp').onclick = () => {
            const n = document.getElementById('name').value.trim();
            const p = document.getElementById('phone').value.trim();
            const e = document.getElementById('email').value.trim();
            const g = document.getElementById('guests').value;
            const a = document.getElementById('arrival').value;
            const d = document.getElementById('departure').value;

            const itinerary = formatItinerary();
            const msg = `Ayubowan Tours Booking
Name: ${n}
Phone: ${p}
Email: ${e}
Guests: ${g}
Arrival: ${a}
Departure: ${d}

Itinerary:
${itinerary}`;

            // Open WhatsApp
            window.open(`https://wa.me/94763661600?text=${encodeURIComponent(msg)}`);

            // Show popup after sending
            const popup = document.getElementById('popupOverlay');
            popup.style.display = 'flex';
        };

        document.getElementById('popupOk').onclick = () => { document.getElementById('popupOverlay').style.display = 'none'; location.reload(); };

        // ---- Email Send ----
        document.getElementById('sendEmail').onclick = () => {
            const n = document.getElementById('name').value.trim();
            const p = document.getElementById('phone').value.trim();
            const e = document.getElementById('email').value.trim();
            const g = document.getElementById('guests').value;
            const a = document.getElementById('arrival').value;
            const d = document.getElementById('departure').value;

            const subject = 'Ayubowan Tours Booking Request';
            const body = `Name: ${n}
Phone: ${p}
Email: ${e}
Guests: ${g}
Arrival: ${a}
Departure: ${d}

Itinerary:
${formatItinerary()}`;

            window.location.href = `mailto:info@ayubowantours.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
        };
    </script>

</body>

</html>