<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ayubowan Tours â€“ Create Your Tour</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f4f6f8;
            padding: 20px;
        }

        h2,
        h3 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .flex-container {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .box-dragging {
            flex: 1 1 320px;
            max-width: 420px;
            background: #fff;
            border: 2px dashed #bbb;
            border-radius: 10px;
            padding: 15px;
            position: relative;
        }

        .items-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .item {
            border-radius: 8px;
            padding: 6px;
            background: linear-gradient(135deg, #ffffff, #eef3ff);
            text-align: center;
            cursor: pointer;
            transition: .25s;
            user-select: none;
        }

        .item img {
            width: 100%;
            height: 90px;
            object-fit: cover;
            border-radius: 5px;
        }

        .item.drag-hold {
            transform: scale(1.05);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, .6), 0 10px 25px rgba(0, 0, 0, .3);
        }

        .drop-pulse {
            position: absolute;
            top: 20%;
            left: 0;
            right: 0;
            text-align: center;
            font-weight: bold;
            color: #3498db;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% {
                opacity: .4
            }

            50% {
                opacity: 1
            }

            100% {
                opacity: .4
            }
        }

        .traveler-info {
            flex: 1 1 320px;
            max-width: 420px;
            background: #fff;
            border-radius: 10px;
            padding: 20px;
        }

        #miniPreview {
            margin-top: 15px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .preview-card {
            padding: 10px;
            color: #fff;
            border-radius: 10px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, .25);
            transition: .3s;
        }

        .preview-card:hover {
            transform: translateY(-4px);
        }

        .preview-title {
            font-weight: 600;
            margin-bottom: 6px;
        }

        .map-frame {
            width: 100%;
            height: 120px;
            border: 0;
            border-radius: 8px;
        }

        input.valid {
            border: 2px solid #28a745 !important;
        }

        input.invalid {
            border: 2px solid #dc3545 !important;
        }

        .validation-msg {
            color: #dc3545;
            font-size: 0.85rem;
            display: none;
            margin-bottom: 5px;
        }

        @media(max-width:768px) {
            .items-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>

    <h2>Create Your Own Tour</h2>

    <div class="flex-container">

        <!-- Available Places -->
        <div class="box-dragging">
            <h3>Available Places</h3>
            <div class="items-grid" id="availableGrid">
                <div class="item" data-id="Kandy"><img src="img/kandy-package-card.jpeg">
                    <div>Kandy</div>
                </div>
                <div class="item" data-id="Sigiriya"><img src="img/kandy-dambulla-sirigiya-package-card.jpg">
                    <div>Sigiriya</div>
                </div>
                <div class="item" data-id="Ella"><img src="img/14-day-tour-srilanka-ella.jpg">
                    <div>Ella</div>
                </div>
                <div class="item" data-id="Yala"><img src="img/14-day-tour-srilanka-yala.jpg">
                    <div>Yala Safari</div>
                </div>
            </div>
        </div>

        <!-- Selected Places -->
        <div class="box-dragging">
            <h3>Selected Places</h3>
            <div class="drop-pulse" id="dropPulse">Drop Here</div>
            <div class="items-grid" id="selectedGrid"></div>
        </div>

        <!-- Booking Form -->
        <div class="traveler-info">
            <h3>Booking Details</h3>

            <input class="form-control mb-1" id="name" placeholder="Customer Name">
            <div class="validation-msg" id="nameMsg">Please enter your name</div>

            <input class="form-control mb-1" id="phone" placeholder="Phone Number">
            <div class="validation-msg" id="phoneMsg">Enter a valid phone number (digits only, min 10)</div>

            <input class="form-control mb-1" id="email" placeholder="Email Address">
            <div class="validation-msg" id="emailMsg">Enter a valid email</div>

            <input class="form-control mb-1" id="guests" type="number" min="1" value="1" placeholder="Number of Guests">
            <div class="validation-msg" id="guestsMsg">Guests must be at least 1</div>

            <label class="mt-2">Arrival Date</label>
            <input class="form-control mb-1" id="arrival" type="date" required>
            <div class="validation-msg" id="arrivalMsg">Please select arrival date</div>

            <label>Departure Date</label>
            <input class="form-control mb-1" id="departure" type="date" required>
            <div class="validation-msg" id="departureMsg">Please select departure date</div>

            <div class="validation-msg" id="dateOrderMsg">Departure date must be after Arrival date</div>

            <div id="miniPreview"><em>No places selected</em></div>

            <button class="btn btn-success w-100 mt-3" id="sendWhatsApp" disabled>Send via WhatsApp</button>
            <button class="btn btn-primary w-100 mt-2" id="sendEmail" disabled>Send via Email</button>
        </div>

    </div>

    <script>
        const availableGrid = document.getElementById('availableGrid');
        const selectedGrid = document.getElementById('selectedGrid');
        const dropPulse = document.getElementById('dropPulse');

        const placeMap = {
            Kandy: '7.2906,80.6337',
            Sigiriya: '7.9570,80.7603',
            Ella: '6.8667,81.0466',
            Yala: '6.3667,81.5167'
        };

        const gradients = [
            'linear-gradient(90deg,#6a11cb,#2575fc)',
            'linear-gradient(90deg,#ff512f,#f09819)',
            'linear-gradient(90deg,#43e97b,#38f9d7)',
            'linear-gradient(90deg,#2193b0,#6dd5ed)'
        ];

        // --- Drag & Drop + Mobile Long Press ---
        let holdTimer = null;
        function bindItem(item) {
            item.draggable = true;

            item.onclick = () => moveItem(item);

            item.addEventListener('touchstart', () => {
                holdTimer = setTimeout(() => item.classList.add('drag-hold'), 400);
            });
            item.addEventListener('touchend', () => {
                clearTimeout(holdTimer);
                if (item.classList.contains('drag-hold')) {
                    item.classList.remove('drag-hold');
                    moveItem(item);
                }
            });

            item.addEventListener('dragstart', () => window.dragged = item);
        }
        document.querySelectorAll('.item').forEach(bindItem);

        // Desktop drag/drop
        [availableGrid, selectedGrid].forEach(grid => {
            grid.addEventListener('dragover', e => e.preventDefault());
            grid.addEventListener('drop', () => {
                if (window.dragged && !grid.contains(window.dragged)) {
                    grid.appendChild(window.dragged);
                    updateUI();
                }
            });
        });

        // Move item between grids
        function moveItem(item) {
            const target = item.parentElement.id === 'availableGrid' ? selectedGrid : availableGrid;
            target.appendChild(item);
            updateUI();
        }

        // --- LocalStorage ---
        function saveToLocal() {
            const selected = [...selectedGrid.children].map(i => i.dataset.id);
            localStorage.setItem('selectedPlaces', JSON.stringify(selected));
        }
        window.onload = function () {
            const stored = JSON.parse(localStorage.getItem('selectedPlaces') || '[]');
            stored.forEach(id => {
                const item = document.querySelector(`#availableGrid .item[data-id="${id}"]`);
                if (item) selectedGrid.appendChild(item);
            });
            updateUI();
        }

        // --- Update preview ---
        function updateUI() {
            dropPulse.style.display = selectedGrid.children.length ? 'none' : 'block';
            saveToLocal();
            const preview = document.getElementById('miniPreview');
            if (!selectedGrid.children.length) {
                preview.innerHTML = '<em>No places selected</em>';
                return;
            }
            preview.innerHTML = '';
            [...selectedGrid.children].forEach((i, idx) => {
                const place = i.dataset.id;
                const card = document.createElement('div');
                card.className = 'preview-card';
                card.style.background = gradients[idx % gradients.length];
                card.innerHTML = `
            <div class="preview-title">${idx + 1}. ${place}</div>
            <iframe class="map-frame" src="https://maps.google.com/maps?q=${placeMap[place]}&z=9&output=embed"></iframe>`;
                preview.appendChild(card);
            });
            validateForm();
        }

        // --- Validation ---
        const fields = [
            { id: 'name', validator: v => v.trim() !== '', msg: 'nameMsg' },
            { id: 'phone', validator: v => /^\d{10,15}$/.test(v), msg: 'phoneMsg' },
            { id: 'email', validator: v => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v), msg: 'emailMsg' },
            { id: 'guests', validator: v => parseInt(v) >= 1, msg: 'guestsMsg' },
            { id: 'arrival', validator: v => v !== '', msg: 'arrivalMsg' },
            { id: 'departure', validator: v => v !== '', msg: 'departureMsg' }
        ];

        function validateForm() {
            let valid = true;
            fields.forEach(f => {
                const field = document.getElementById(f.id);
                const msg = document.getElementById(f.msg);
                if (!f.validator(field.value)) {
                    msg.style.display = 'block';
                    field.classList.add('invalid');
                    field.classList.remove('valid');
                    valid = false;
                } else {
                    msg.style.display = 'none';
                    field.classList.remove('invalid');
                    field.classList.add('valid');
                }
            });

            // Departure > Arrival
            const arrivalVal = document.getElementById('arrival').value;
            const departureVal = document.getElementById('departure').value;
            const dateOrderMsg = document.getElementById('dateOrderMsg');
            if (arrivalVal && departureVal && new Date(departureVal) <= new Date(arrivalVal)) {
                dateOrderMsg.style.display = 'block';
                document.getElementById('arrival').classList.add('invalid');
                document.getElementById('departure').classList.add('invalid');
                document.getElementById('arrival').classList.remove('valid');
                document.getElementById('departure').classList.remove('valid');
                valid = false;
            } else dateOrderMsg.style.display = 'none';

            if (!selectedGrid.children.length) valid = false;

            document.getElementById('sendWhatsApp').disabled = !valid;
            document.getElementById('sendEmail').disabled = !valid;
        }

        // Listen to input changes
        fields.concat([{ id: 'arrival' }, { id: 'departure' }]).forEach(f => {
            document.getElementById(f.id).addEventListener('input', validateForm);
        });
        selectedGrid.addEventListener('DOMSubtreeModified', validateForm);

        // --- Format itinerary ---
        function formatItinerary() {
            return [...selectedGrid.children].map((i, x) => `${x + 1}. ${i.dataset.id}`).join('\n');
        }

        // --- WhatsApp ---
        document.getElementById('sendWhatsApp').onclick = () => {
            const n = name.value, p = phone.value, e = email.value, g = guests.value, a = arrival.value, d = departure.value;
            const itinerary = formatItinerary();
            const msg = `Ayubowan Tours Booking
Name: ${n}
Phone: ${p}
Email: ${e}
Guests: ${g}
Arrival: ${a}
Departure: ${d}

Itinerary:
${itinerary}`;
            window.open(`https://wa.me/94763661600?text=${encodeURIComponent(msg)}`);
        };

        // --- Email ---
        document.getElementById('sendEmail').onclick = () => {
            const subject = 'Ayubowan Tours Booking Request';
            const body = `Name: ${name.value}
Phone: ${phone.value}
Email: ${email.value}
Guests: ${guests.value}
Arrival: ${arrival.value}
Departure: ${departure.value}

Itinerary:
${formatItinerary()}`;
            window.location.href = `mailto:info@ayubowantours.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
        };
    </script>
</body>

</html>